<!-- this file is dedicated to working around bugs in Microsoft.NET.Sdk RC.2 release -->
<Project>
    <!-- workaround https://github.com/Microsoft/vstest/issues/191 -->
    <PropertyGroup
        Condition="$(MSBuildProjectName.EndsWith('Test')) OR $(MSBuildProjectName.EndsWith('Tests'))">
        <OutputType Condition="$(TargetFramework.StartsWith('netcoreapp'))">exe</OutputType>
    </PropertyGroup>
    <!-- end workaround -->

    <!-- workaround https://github.com/NuGet/Home/issues/4063 -->
    <Target Name="ResolveRestoredPackageVersions"
            BeforeTargets="GenerateNuspec"
            DependsOnTargets="ResolvePackageDependenciesDesignTime"
            Condition="'$(TargetFramework)'!=''">

        <ItemGroup>
            <_FloatingVersions Include="@(_PackageReferences)" Condition="$([System.String]::new('%(Version)').EndsWith('*'))" />
            <_ResolvedFloatingVersion Include="@(_FloatingVersions)">
                <ResolvedName>%(_DependenciesDesignTime.Name)</ResolvedName>
                <Version>%(_DependenciesDesignTime.Version)</Version>
            </_ResolvedFloatingVersion>
            <_PackageReferences Remove="@(_PackageReferences)" Condition="$([System.String]::new('%(Version)').EndsWith('*'))" />
            <_PackageReferences Include="@(_ResolvedFloatingVersion)" Condition="'%(Identity)'=='%(_ResolvedFloatingVersion.ResolvedName)'" />
        </ItemGroup>
    </Target>
    <!-- end workaround -->

    <!-- workaround https://github.com/dotnet/sdk/issues/490 -->
    <ItemGroup>
        <Compile Include="$(MSBuildThisFileDirectory)..\contentFiles\cs\any\AssemblyInfo.Serviceable.cs"
                 Condition="'$(DesignTimeBuild)'!='true'"
                 Visible="false" />
        <!-- checking DesignTimeBuild hides the file from from VS solution explorer which does not yet support 'Visible' -->
    </ItemGroup>
    <!-- end workaround -->
</Project>